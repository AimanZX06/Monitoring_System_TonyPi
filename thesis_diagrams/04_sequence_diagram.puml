@startuml TonyPi_Sequence_Diagram

title TonyPi Robot Monitoring System - Sequence Diagram
skinparam responseMessageBelowArrow true

actor "User" as User
participant "Frontend" as FE
participant "Backend" as BE
participant "MQTT" as MQTT
database "InfluxDB" as IDB
database "PostgreSQL" as PG
participant "Robot" as Robot

== 1. Real-Time Telemetry Flow ==

Robot -> MQTT : publish(telemetry)
MQTT -> BE : on_message()
BE -> IDB : store_metrics()
BE -> FE : WebSocket push
FE -> User : Update dashboard

== 2. Send Command to Robot ==

User -> FE : Select command
FE -> BE : POST /command
BE -> MQTT : publish(control)
MQTT -> Robot : execute()
Robot -> MQTT : publish(ack)
MQTT -> BE : on_message()
BE -> FE : WebSocket update
FE -> User : Show result

== 3. Authentication ==

User -> FE : Login request
FE -> BE : POST /auth/login
BE -> PG : Verify credentials
PG --> BE : User data
BE --> FE : JWT token
FE -> User : Redirect to dashboard

== 4. Alert Handling ==

Robot -> MQTT : publish(high_temp)
MQTT -> BE : on_message()
BE -> BE : Check threshold
BE -> PG : Create alert
BE -> FE : WebSocket alert
FE -> User : Show notification
User -> FE : Acknowledge
FE -> BE : POST /alerts/ack
BE -> PG : Update status

@enduml
